<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Personel Takip ONLINE</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
body{font-family:Arial;padding:20px;background:#fff;color:#000}
input,select,textarea,button{padding:8px;margin:5px 0;width:100%}
button{cursor:pointer}
.hidden{display:none}
.card{border:1px solid #ddd;padding:15px;margin-bottom:20px}
</style>
</head>
<body>

<h2>Personel Takip (ONLINE)</h2>

<!-- PERSONEL -->
<div class="card">
<h3>Personel</h3>
<input id="ad" placeholder="Ad Soyad">
<input id="sifre" type="password" placeholder="Åžifre">
<button onclick="giris()">GiriÅŸ / KayÄ±t</button>

<div id="personelPanel" class="hidden">
<select id="tur">
<option value="not">Not</option>
<option value="giris">GiriÅŸ</option>
<option value="cikis">Ã‡Ä±kÄ±ÅŸ</option>
<option value="izin">Ä°zin</option>
</select>
<textarea id="notText" placeholder="Not yaz"></textarea>
<button onclick="kaydet()">KaydÄ± GÃ¶nder</button>
<button onclick="kendiKayitlarim()">Yenile</button>
<div id="liste"></div>
</div>
</div>

<!-- ADMIN -->
<div class="card">
<h3>Admin</h3>
<input id="adminSifre" type="password" placeholder="Admin Åžifre">
<button onclick="adminGiris()">Admin GiriÅŸ</button>

<div id="adminPanel" class="hidden">
<button onclick="tumKayitlar()">Yenile</button>
<div id="adminListe"></div>
</div>
</div>

<script>

// ðŸ‘‡ BURAYA KENDÄ° BÄ°LGÄ°LERÄ°NÄ° KOY
const supabase = window.supabase.createClient(
  "sb_publishable_st-oRCixt2NLZnE1CFga6A_fCqdcGZn",
  "2550d2afd71062bde89a04d5b2ad55ec502d35a1f9b8ff89"
);

let aktifPersonel = null;

// PERSONEL GÄ°RÄ°Åž
async function giris(){
  const ad = document.getElementById("ad").value.trim();
  const sifre = document.getElementById("sifre").value.trim();
  if(!ad || !sifre) return alert("Ad ve ÅŸifre gerekli");

  // Ã¶nce var mÄ± bak
  let { data } = await supabase
    .from("personeller")
    .select("*")
    .eq("ad_soyad", ad)
    .single();

  if(!data){
    // yoksa oluÅŸtur
    await supabase.from("personeller").insert([
      { ad_soyad: ad, sifre: sifre }
    ]);
    aktifPersonel = ad;
  } else {
    if(data.sifre !== sifre) return alert("Åžifre yanlÄ±ÅŸ");
    aktifPersonel = ad;
  }

  localStorage.setItem("aktifPersonel", ad);
  document.getElementById("personelPanel").classList.remove("hidden");
  kendiKayitlarim();
}

// OTOMATÄ°K OTURUM
window.onload = function(){
  const kayit = localStorage.getItem("aktifPersonel");
  if(kayit){
    aktifPersonel = kayit;
    document.getElementById("personelPanel").classList.remove("hidden");
    kendiKayitlarim();
  }
}

// KAYDET
async function kaydet(){
  const tur = document.getElementById("tur").value;
  const notText = document.getElementById("notText").value;
  if(!notText) return alert("Not gerekli");

  await supabase.from("hareketler").insert([
    { personel_id: aktifPersonel, tur: tur, not_text: notText }
  ]);

  document.getElementById("notText").value = "";
  alert("Kaydedildi");
}

// KENDÄ° KAYITLARI
async function kendiKayitlarim(){
  const { data } = await supabase
    .from("hareketler")
    .select("*")
    .eq("personel_id", aktifPersonel)
    .order("created_at",{ascending:false});

  let html="";
  data.forEach(x=>{
    html+=`<div><b>${x.tur}</b> - ${x.not_text}</div>`;
  });

  document.getElementById("liste").innerHTML = html;
}

// ADMIN
function adminGiris(){
  const sifre = document.getElementById("adminSifre").value;
  if(sifre !== "070707") return alert("YanlÄ±ÅŸ");
  document.getElementById("adminPanel").classList.remove("hidden");
  tumKayitlar();
}

// TÃœM KAYITLAR
async function tumKayitlar(){
  const { data } = await supabase
    .from("hareketler")
    .select("*")
    .order("created_at",{ascending:false});

  let html="";
  data.forEach(x=>{
    html+=`<div><b>${x.personel_id}</b> - ${x.tur} - ${x.not_text}</div>`;
  });

  document.getElementById("adminListe").innerHTML = html;
}

</script>
</body>
</html>
