<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Personel Takip ONLINE</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{font-family:Arial;background:#f5f5f5;padding:20px}
.card{background:#fff;padding:20px;margin-bottom:20px;border-radius:8px;box-shadow:0 2px 5px rgba(0,0,0,0.1)}
input,select,textarea,button{width:100%;padding:10px;margin:6px 0;border-radius:6px;border:1px solid #ccc}
button{cursor:pointer;background:#2d6cdf;color:#fff;border:none}
button:hover{opacity:0.9}
.hidden{display:none}
.kayit{border-bottom:1px solid #eee;padding:8px 0}
h2{margin-bottom:20px}
</style>
</head>
<body>

<h2>Personel Takip (ONLINE)</h2>

<div class="card">
<h3>Personel</h3>
<input id="ad" placeholder="Ad Soyad">
<input id="sifre" type="password" placeholder="Åžifre">
<button onclick="giris()">GiriÅŸ / KayÄ±t</button>

<div id="personelPanel" class="hidden">
<select id="tur">
<option value="not">Not</option>
<option value="giris">GiriÅŸ</option>
<option value="cikis">Ã‡Ä±kÄ±ÅŸ</option>
<option value="izin">Ä°zin</option>
</select>
<textarea id="notText" placeholder="Not yaz (zorunlu)"></textarea>
<button onclick="kaydet()">KaydÄ± GÃ¶nder</button>
<button onclick="kendiKayitlarim()">Yenile</button>
<div id="liste"></div>
</div>
</div>

<div class="card">
<h3>Admin</h3>
<input id="adminSifre" type="password" placeholder="Admin Åžifre (070707)">
<button onclick="adminGiris()">Admin GiriÅŸ</button>

<div id="adminPanel" class="hidden">
<button onclick="tumKayitlar()">Yenile</button>
<div id="adminListe"></div>
</div>
</div>

<script>

// ðŸ”¹ SUPABASE BÄ°LGÄ°LERÄ° (DÃ¼nkÃ¼ proje)
const supabase = window.supabase.createClient(
  "https://sb_publishable_st-oRCixt2NLZnE1CFga6A_fCqdcGZn.supabase.co",
  "2550d2afd71062bde89a04d5b2ad55ec502d35a1f9b8ff89"
);

let aktifPersonel = null;

// PERSONEL GÄ°RÄ°Åž
async function giris(){
  const ad = document.getElementById("ad").value.trim();
  const sifre = document.getElementById("sifre").value.trim();
  if(!ad || !sifre) return alert("Ad ve ÅŸifre gerekli");

  const { data, error } = await supabase
    .from("personeller")
    .select("*")
    .eq("ad_soyad", ad)
    .maybeSingle();

  if(error){ alert(error.message); return; }

  if(!data){
    await supabase.from("personeller").insert([
      { ad_soyad: ad, sifre: sifre }
    ]);
  } else {
    if(data.sifre !== sifre) return alert("Åžifre yanlÄ±ÅŸ");
  }

  aktifPersonel = ad;
  localStorage.setItem("aktifPersonel", ad);
  document.getElementById("personelPanel").classList.remove("hidden");
  kendiKayitlarim();
}

// OTOMATÄ°K OTURUM
window.onload = function(){
  const kayit = localStorage.getItem("aktifPersonel");
  if(kayit){
    aktifPersonel = kayit;
    document.getElementById("personelPanel").classList.remove("hidden");
    kendiKayitlarim();
  }
}

// KAYDET
async function kaydet(){
  if(!aktifPersonel) return alert("Ã–nce giriÅŸ yap");

  const tur = document.getElementById("tur").value;
  const notText = document.getElementById("notText").value.trim();
  if(!notText) return alert("Not gerekli");

  const { error } = await supabase.from("hareketler").insert([
    { personel_id: aktifPersonel, tur: tur, not_text: notText }
  ]);

  if(error){ alert(error.message); return; }

  document.getElementById("notText").value = "";
  alert("Kaydedildi");
  kendiKayitlarim();
}

// KENDÄ° KAYITLARI
async function kendiKayitlarim(){
  if(!aktifPersonel) return;

  const { data } = await supabase
    .from("hareketler")
    .select("*")
    .eq("personel_id", aktifPersonel)
    .order("created_at",{ascending:false})
    .limit(200);

  let html="";
  if(!data || data.length===0){
    html="KayÄ±t yok";
  }else{
    data.forEach(x=>{
      html+=`<div class="kayit"><b>${x.tur}</b> - ${x.not_text}</div>`;
    });
  }

  document.getElementById("liste").innerHTML = html;
}

// ADMIN
function adminGiris(){
  const sifre = document.getElementById("adminSifre").value.trim();
  if(sifre !== "070707") return alert("YanlÄ±ÅŸ ÅŸifre");

  document.getElementById("adminPanel").classList.remove("hidden");
  tumKayitlar();
}

// TÃœM KAYITLAR
async function tumKayitlar(){
  const { data } = await supabase
    .from("hareketler")
    .select("*")
    .order("created_at",{ascending:false})
    .limit(300);

  let html="";
  if(!data || data.length===0){
    html="KayÄ±t yok";
  }else{
    data.forEach(x=>{
      html+=`<div class="kayit"><b>${x.personel_id}</b> - ${x.tur} - ${x.not_text}</div>`;
    });
  }

  document.getElementById("adminListe").innerHTML = html;
}

</script>
</body>
</html>
