<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Personel Takip ONLINE</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{font-family:Arial;background:#fff;color:#000;padding:20px}
input,select,textarea,button{padding:8px;margin:5px 0;width:100%}
button{cursor:pointer}
.card{border:1px solid #ddd;padding:15px;margin-bottom:20px}
.hidden{display:none}
h2{margin-bottom:20px}
</style>
</head>
<body>

<h2>Personel Takip (ONLINE)</h2>

<!-- PERSONEL -->
<div class="card">
<h3>Personel</h3>

<input id="ad" placeholder="Ad Soyad">
<input id="sifre" type="password" placeholder="Åžifre">
<button onclick="giris()">GiriÅŸ / KayÄ±t</button>

<div id="personelPanel" class="hidden">
<select id="tur">
<option value="not">Not</option>
<option value="giris">GiriÅŸ</option>
<option value="cikis">Ã‡Ä±kÄ±ÅŸ</option>
<option value="izin">Ä°zin</option>
</select>

<textarea id="notText" placeholder="Not yaz (zorunlu)"></textarea>

<button onclick="kaydet()">KaydÄ± GÃ¶nder</button>
<button onclick="kendiKayitlarim()">Yenile</button>

<div id="liste"></div>
</div>
</div>


<!-- ADMIN -->
<div class="card">
<h3>Admin</h3>

<input id="adminSifre" type="password" placeholder="Admin Åžifre (070707)">
<button onclick="adminGiris()">Admin GiriÅŸ</button>

<div id="adminPanel" class="hidden">
<button onclick="tumKayitlar()">TÃ¼m KayÄ±tlarÄ± Yenile</button>
<div id="adminListe"></div>
</div>
</div>


<script>

// ðŸ”¹ SUPABASE BÄ°LGÄ°LERÄ°
const supabase = window.supabase.createClient(
  "https://ngnpocqaznpuggsvwbif.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5nbnBvY3Fhem5wdWdnc3Z3YmlmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA3MDIzNzksImV4cCI6MjA4NjI3ODM3OX0.a2bCf0CfV7Vur6z60Q9O1nBXVdsCPHL3KJTBiEmbpec"
);

let aktifPersonel = null;


// ðŸ”¹ PERSONEL GÄ°RÄ°Åž / KAYIT
async function giris(){
  const ad = document.getElementById("ad").value.trim();
  const sifre = document.getElementById("sifre").value.trim();

  if(!ad || !sifre){
    alert("Ad ve ÅŸifre gerekli");
    return;
  }

  let { data, error } = await supabase
    .from("personeller")
    .select("*")
    .eq("ad_soyad", ad)
    .single();

  if(!data){
    // Yeni kayÄ±t
    const { error: insertErr } = await supabase
      .from("personeller")
      .insert([{ ad_soyad: ad, sifre: sifre }]);

    if(insertErr){
      alert("KayÄ±t hatasÄ±: " + insertErr.message);
      return;
    }

    aktifPersonel = ad;
  } else {
    if(data.sifre !== sifre){
      alert("Åžifre yanlÄ±ÅŸ");
      return;
    }
    aktifPersonel = ad;
  }

  localStorage.setItem("aktifPersonel", ad);
  document.getElementById("personelPanel").classList.remove("hidden");
  kendiKayitlarim();
}


// ðŸ”¹ OTOMATÄ°K OTURUM
window.onload = function(){
  const kayit = localStorage.getItem("aktifPersonel");
  if(kayit){
    aktifPersonel = kayit;
    document.getElementById("personelPanel").classList.remove("hidden");
    kendiKayitlarim();
  }
}


// ðŸ”¹ KAYIT EKLE
async function kaydet(){
  if(!aktifPersonel){
    alert("Ã–nce giriÅŸ yap");
    return;
  }

  const tur = document.getElementById("tur").value;
  const notText = document.getElementById("notText").value.trim();

  if(!notText){
    alert("Not gerekli");
    return;
  }

  const { error } = await supabase
    .from("hareketler")
    .insert([{ personel_id: aktifPersonel, tur: tur, not_text: notText }]);

  if(error){
    alert("KayÄ±t hatasÄ±: " + error.message);
    return;
  }

  document.getElementById("notText").value = "";
  alert("Kaydedildi");
  kendiKayitlarim();
}


// ðŸ”¹ PERSONEL KENDÄ° KAYITLARI
async function kendiKayitlarim(){
  const { data, error } = await supabase
    .from("hareketler")
    .select("*")
    .eq("personel_id", aktifPersonel)
    .order("created_at",{ascending:false})
    .limit(100);

  if(error){
    alert("Liste hatasÄ±: " + error.message);
    return;
  }

  let html="";
  data.forEach(x=>{
    html+=`<div><b>${x.tur}</b> - ${x.not_text}</div>`;
  });

  document.getElementById("liste").innerHTML = html;
}


// ðŸ”¹ ADMIN GÄ°RÄ°Åž
function adminGiris(){
  const sifre = document.getElementById("adminSifre").value.trim();

  if(sifre !== "070707"){
    alert("YanlÄ±ÅŸ ÅŸifre");
    return;
  }

  document.getElementById("adminPanel").classList.remove("hidden");
  tumKayitlar();
}


// ðŸ”¹ TÃœM KAYITLAR
async function tumKayitlar(){
  const { data, error } = await supabase
    .from("hareketler")
    .select("*")
    .order("created_at",{ascending:false})
    .limit(300);

  if(error){
    alert("Admin liste hatasÄ±: " + error.message);
    return;
  }

  let html="";
  data.forEach(x=>{
    html+=`<div><b>${x.personel_id}</b> - ${x.tur} - ${x.not_text}</div>`;
  });

  document.getElementById("adminListe").innerHTML = html;
}

</script>
</body>
</html>
